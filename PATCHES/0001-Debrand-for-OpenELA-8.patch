From 84b1a37ae1e34695795095a4076867e4effc86e3 Mon Sep 17 00:00:00 2001
From: Mustafa Gezen <mustafa@ctrliq.com>
Date: Mon, 13 Nov 2023 17:20:16 +0100
Subject: [PATCH] Debrand for OpenELA 8

---
 SOURCES/kernel-aarch64-debug.config  |  2 +-
 SOURCES/kernel-aarch64.config        |  2 +-
 SOURCES/kernel-ppc64le-debug.config  |  2 +-
 SOURCES/kernel-ppc64le.config        |  2 +-
 SOURCES/kernel-s390x-debug.config    |  2 +-
 SOURCES/kernel-s390x-zfcpdump.config |  2 +-
 SOURCES/kernel-s390x.config          |  2 +-
 SOURCES/kernel-x86_64-debug.config   |  2 +-
 SOURCES/kernel-x86_64.config         |  2 +-
 SPECS/kernel.spec                    | 52 +++++++++-------------------
 10 files changed, 25 insertions(+), 45 deletions(-)

diff --git a/SOURCES/kernel-aarch64-debug.config b/SOURCES/kernel-aarch64-debug.config
index b46f57f..56ad047 100644
--- a/SOURCES/kernel-aarch64-debug.config
+++ b/SOURCES/kernel-aarch64-debug.config
@@ -2919,7 +2919,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-aarch64.config b/SOURCES/kernel-aarch64.config
index 18975c9..d8d0e3a 100644
--- a/SOURCES/kernel-aarch64.config
+++ b/SOURCES/kernel-aarch64.config
@@ -2982,7 +2982,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-ppc64le-debug.config b/SOURCES/kernel-ppc64le-debug.config
index 135c12b..72d0586 100644
--- a/SOURCES/kernel-ppc64le-debug.config
+++ b/SOURCES/kernel-ppc64le-debug.config
@@ -2593,7 +2593,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-ppc64le.config b/SOURCES/kernel-ppc64le.config
index 2e51473..cee92db 100644
--- a/SOURCES/kernel-ppc64le.config
+++ b/SOURCES/kernel-ppc64le.config
@@ -2653,7 +2653,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-s390x-debug.config b/SOURCES/kernel-s390x-debug.config
index d7fedd1..fbc2125 100644
--- a/SOURCES/kernel-s390x-debug.config
+++ b/SOURCES/kernel-s390x-debug.config
@@ -2714,7 +2714,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-s390x-zfcpdump.config b/SOURCES/kernel-s390x-zfcpdump.config
index 9eec20e..9af4a98 100644
--- a/SOURCES/kernel-s390x-zfcpdump.config
+++ b/SOURCES/kernel-s390x-zfcpdump.config
@@ -2925,7 +2925,7 @@ CONFIG_CRYPTO_ECHAINIV=y
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=y
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-s390x.config b/SOURCES/kernel-s390x.config
index f290d9b..a23587a 100644
--- a/SOURCES/kernel-s390x.config
+++ b/SOURCES/kernel-s390x.config
@@ -2776,7 +2776,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-x86_64-debug.config b/SOURCES/kernel-x86_64-debug.config
index 09dc447..5295043 100644
--- a/SOURCES/kernel-x86_64-debug.config
+++ b/SOURCES/kernel-x86_64-debug.config
@@ -2654,7 +2654,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-x86_64.config b/SOURCES/kernel-x86_64.config
index 36df590..927715a 100644
--- a/SOURCES/kernel-x86_64.config
+++ b/SOURCES/kernel-x86_64.config
@@ -2716,7 +2716,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SPECS/kernel.spec b/SPECS/kernel.spec
index 9f1c152..cf5fd0b 100644
--- a/SPECS/kernel.spec
+++ b/SPECS/kernel.spec
@@ -447,34 +447,12 @@ Source9: x509.genkey
 %define signing_key_filename kernel-signing-s390.cer
 %endif
 
-Source10: redhatsecurebootca3.cer
-Source11: redhatsecurebootca5.cer
-Source12: redhatsecureboot301.cer
-Source13: redhatsecureboot501.cer
-Source14: secureboot_s390.cer
-Source15: secureboot_ppc.cer
-Source16: redhatsecurebootca7.cer
+Source10: openelasecurebootca.cer
+Source12: openelasecureboot.cer
 
 %define secureboot_ca_0 %{SOURCE10}
-%define secureboot_ca_1 %{SOURCE11}
-%define secureboot_ca_2 %{SOURCE16}
-
-%ifarch x86_64 aarch64
 %define secureboot_key_0 %{SOURCE12}
 %define pesign_name_0 redhatsecureboot301
-%define secureboot_key_1 %{SOURCE13}
-%define pesign_name_1 redhatsecureboot501
-%endif
-
-%ifarch s390x
-%define secureboot_key_0 %{SOURCE14}
-%define pesign_name_0 redhatsecureboot302
-%endif
-
-%ifarch ppc64le
-%define secureboot_key_0 %{SOURCE15}
-%define pesign_name_0 redhatsecureboot701
-%endif
 
 Source17: mod-blacklist.sh
 Source18: mod-sign.sh
@@ -503,8 +481,8 @@ Source43: generate_bls_conf.sh
 
 Source44: mod-internal.list
 
-Source100: rheldup3.x509
-Source101: rhelkpatch1.x509
+Source100: openeladup1.x509
+Source101: openelakpatch1.x509
 
 %if %{with_kabichk}
 Source200: check-kabi
@@ -541,14 +519,15 @@ Source4001: rpminspect.yaml
 
 # empty final patch to facilitate testing of kernel patches
 Patch999999: linux-kernel-test.patch
+Patch1000000: 1000-Debrand-specific-Red-Hat-messages.patch
 
 # END OF PATCH DEFINITIONS
 
 BuildRoot: %{_tmppath}/%{name}-%{KVERREL}-root
 
 %description
-This is the package which provides the Linux %{name} for Red Hat Enterprise
-Linux. It is based on upstream Linux at version %{version} and maintains kABI
+This is the package which provides the Linux %{name} for OpenELA.
+It is based on upstream Linux at version %{version} and maintains kABI
 compatibility of a set of approved symbols, however it is heavily modified with
 backports and fixes pulled from newer upstream Linux %{name} releases. This means
 this is not a %{version} kernel anymore: it includes several components which come
@@ -556,7 +535,7 @@ from newer upstream linux versions, while maintaining a well tested and stable
 core. Some of the components/backports that may be pulled in are: changes like
 updates to the core kernel (eg.: scheduler, cgroups, memory management, security
 fixes and features), updates to block layer, supported filesystems, major driver
-updates for supported hardware in Red Hat Enterprise Linux, enhancements for
+updates for supported hardware in OpenELA, enhancements for
 enterprise customers, etc.
 
 #
@@ -800,14 +779,14 @@ kernel-gcov includes the gcov graph and source files for gcov coverage collectio
 %endif
 
 %package -n %{name}-abi-stablelists
-Summary: The Red Hat Enterprise Linux kernel ABI symbol stablelists
+Summary: The OpenELA kernel ABI symbol stablelists
 Group: System Environment/Kernel
 AutoReqProv: no
 Obsoletes: %{name}-abi-whitelists < %{rpmversion}-%{pkg_release}
 Provides: %{name}-abi-whitelists
 %description -n %{name}-abi-stablelists
-The kABI package contains information pertaining to the Red Hat Enterprise
-Linux kernel ABI, including lists of kernel symbols that are needed by
+The kABI package contains information pertaining to the OpenELA
+kernel ABI, including lists of kernel symbols that are needed by
 external Linux kernel modules, and a yum plugin to aid enforcement.
 
 %if %{with_kabidw_base}
@@ -816,8 +795,8 @@ Summary: The baseline dataset for kABI verification using DWARF data
 Group: System Environment/Kernel
 AutoReqProv: no
 %description kernel-kabidw-base-internal
-The package contains data describing the current ABI of the Red Hat Enterprise
-Linux kernel, suitable for the kabi-dw tool.
+The package contains data describing the current ABI of the OpenELA
+kernel, suitable for the kabi-dw tool.
 %endif
 
 #
@@ -891,7 +870,7 @@ Requires: %{name}%{?1:-%{1}}-modules-uname-r = %{KVERREL}%{?variant}%{?1:+%{1}}\
 AutoReq: no\
 AutoProv: yes\
 %description %{?1:%{1}-}modules-internal\
-This package provides kernel modules for the %{?2:%{2} }kernel package for Red Hat internal usage.\
+This package provides kernel modules for the %{?2:%{2} }kernel package for OpenELA internal usage.\
 %{nil}
 
 #
@@ -1094,6 +1073,7 @@ mv linux-%{rpmversion}-%{pkgrelease} linux-%{KVERREL}
 cd linux-%{KVERREL}
 
 ApplyOptionalPatch linux-kernel-test.patch
+ApplyOptionalPatch 1000-Debrand-specific-Red-Hat-messages.patch
 
 # END OF PATCH APPLICATIONS
 
@@ -1743,7 +1723,7 @@ BuildKernel() {
     # build a BLS config for this kernel
     %{SOURCE43} "$KernelVer" "$RPM_BUILD_ROOT" "%{?variant}"
 
-    # Red Hat UEFI Secure Boot CA cert, which can be used to authenticate the kernel
+    # OpenELA UEFI Secure Boot CA cert, which can be used to authenticate the kernel
     mkdir -p $RPM_BUILD_ROOT%{_datadir}/doc/kernel-keys/$KernelVer
     %ifarch x86_64 aarch64
         install -m 0644 %{secureboot_ca_0} $RPM_BUILD_ROOT%{_datadir}/doc/kernel-keys/$KernelVer/kernel-signing-ca-20200609.cer
-- 
2.39.3 (Apple Git-145)

