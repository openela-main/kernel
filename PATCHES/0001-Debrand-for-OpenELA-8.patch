From 0a6a65b6401889037f0507f9d25023ea85768c38 Mon Sep 17 00:00:00 2001
From: Alex Burmashev <alexander.burmashev@oracle.com>
Date: Tue, 5 Mar 2024 16:23:47 +0000
Subject: [PATCH] Debrand for OpenELA 8

---
 SOURCES/kernel-aarch64-debug.config  |  2 +-
 SOURCES/kernel-aarch64.config        |  2 +-
 SOURCES/kernel-ppc64le-debug.config  |  2 +-
 SOURCES/kernel-ppc64le.config        |  2 +-
 SOURCES/kernel-s390x-debug.config    |  2 +-
 SOURCES/kernel-s390x-zfcpdump.config |  2 +-
 SOURCES/kernel-s390x.config          |  2 +-
 SOURCES/kernel-x86_64-debug.config   |  2 +-
 SOURCES/kernel-x86_64.config         |  2 +-
 SPECS/kernel.spec                    | 61 +++++++++-------------------
 10 files changed, 28 insertions(+), 51 deletions(-)

diff --git a/SOURCES/kernel-aarch64-debug.config b/SOURCES/kernel-aarch64-debug.config
index e1cb171..9933cae 100644
--- a/SOURCES/kernel-aarch64-debug.config
+++ b/SOURCES/kernel-aarch64-debug.config
@@ -2946,7 +2946,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-aarch64.config b/SOURCES/kernel-aarch64.config
index c65bd1f..7bb273e 100644
--- a/SOURCES/kernel-aarch64.config
+++ b/SOURCES/kernel-aarch64.config
@@ -3009,7 +3009,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-ppc64le-debug.config b/SOURCES/kernel-ppc64le-debug.config
index 9abb285..2cb5548 100644
--- a/SOURCES/kernel-ppc64le-debug.config
+++ b/SOURCES/kernel-ppc64le-debug.config
@@ -2618,7 +2618,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-ppc64le.config b/SOURCES/kernel-ppc64le.config
index 70f18bd..0851e63 100644
--- a/SOURCES/kernel-ppc64le.config
+++ b/SOURCES/kernel-ppc64le.config
@@ -2678,7 +2678,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-s390x-debug.config b/SOURCES/kernel-s390x-debug.config
index 9b6e4a4..5bd75b1 100644
--- a/SOURCES/kernel-s390x-debug.config
+++ b/SOURCES/kernel-s390x-debug.config
@@ -2739,7 +2739,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-s390x-zfcpdump.config b/SOURCES/kernel-s390x-zfcpdump.config
index 4a5a0a6..fe72021 100644
--- a/SOURCES/kernel-s390x-zfcpdump.config
+++ b/SOURCES/kernel-s390x-zfcpdump.config
@@ -2950,7 +2950,7 @@ CONFIG_CRYPTO_ECHAINIV=y
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=y
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-s390x.config b/SOURCES/kernel-s390x.config
index b58d105..0ec971d 100644
--- a/SOURCES/kernel-s390x.config
+++ b/SOURCES/kernel-s390x.config
@@ -2801,7 +2801,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-x86_64-debug.config b/SOURCES/kernel-x86_64-debug.config
index 18547b4..dcf6d62 100644
--- a/SOURCES/kernel-x86_64-debug.config
+++ b/SOURCES/kernel-x86_64-debug.config
@@ -2677,7 +2677,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SOURCES/kernel-x86_64.config b/SOURCES/kernel-x86_64.config
index e9a23b4..a0838b6 100644
--- a/SOURCES/kernel-x86_64.config
+++ b/SOURCES/kernel-x86_64.config
@@ -2739,7 +2739,7 @@ CONFIG_CRYPTO_ECHAINIV=m
 CONFIG_CRYPTO_ESSIV=y
 CONFIG_CRYPTO_FCRYPT=m
 CONFIG_CRYPTO_FIPS=y
-CONFIG_CRYPTO_FIPS_NAME="Red Hat Enterprise Linux 8 - Kernel Cryptographic API"
+CONFIG_CRYPTO_FIPS_NAME="OpenELA 8 - Kernel Cryptographic API"
 CONFIG_CRYPTO_GCM=y
 CONFIG_CRYPTO_GF128MUL=y
 CONFIG_CRYPTO_GHASH=y
diff --git a/SPECS/kernel.spec b/SPECS/kernel.spec
index e3afa14..adb71bf 100644
--- a/SPECS/kernel.spec
+++ b/SPECS/kernel.spec
@@ -447,37 +447,12 @@ Source9: x509.genkey
 %define signing_key_filename kernel-signing-s390.cer
 %endif
 
-Source10: redhatsecurebootca3.cer
-Source11: centossecurebootca2.cer
-Source12: centossecureboot201.cer
-Source13: redhatsecureboot501.cer
-Source14: redhatsecureboot302.cer
-Source15: redhatsecureboot303.cer
-Source16: redhatsecurebootca7.cer
-%if 0%{?centos}
-%define secureboot_ca_0  %{SOURCE11}
-%define secureboot_key_0 %{SOURCE12}
-%define pesign_name_0 centossecureboot201
-%else
-
-%ifarch x86_64 aarch64
-%define secureboot_ca_0 %{SOURCE10}
-%define secureboot_key_0 %{SOURCE13}
-%define pesign_name_0 redhatsecureboot501
-%endif
-
-%ifarch s390x
-%define secureboot_ca_0 %{SOURCE10}
-%define secureboot_key_0 %{SOURCE14}
-%define pesign_name_0 redhatsecureboot302
-%endif
+Source10: openela-root-ca.der
+Source12: openela-signing.der
 
-%ifarch ppc64le
-%define secureboot_ca_0 %{SOURCE16}
-%define secureboot_key_0 %{SOURCE15}
-%define pesign_name_0 redhatsecureboot701
-%endif
-%endif
+%define secureboot_ca_0  %{SOURCE10}
+%define secureboot_key_0 %{SOURCE12}
+%define pesign_name_0 openelabootsigningcert
 
 Source17: mod-blacklist.sh
 Source18: mod-sign.sh
@@ -506,8 +481,8 @@ Source43: generate_bls_conf.sh
 
 Source44: mod-internal.list
 
-Source100: rheldup3.x509
-Source101: rhelkpatch1.x509
+Source100: openeladup1.x509
+Source101: openelakpatch1.x509
 
 %if %{with_kabichk}
 Source200: check-kabi
@@ -544,14 +519,15 @@ Source4001: rpminspect.yaml
 
 # empty final patch to facilitate testing of kernel patches
 Patch999999: linux-kernel-test.patch
+Patch1000000: 1000-Debrand-specific-Red-Hat-messages.patch
 
 # END OF PATCH DEFINITIONS
 
 BuildRoot: %{_tmppath}/%{name}-%{KVERREL}-root
 
 %description
-This is the package which provides the Linux %{name} for Red Hat Enterprise
-Linux. It is based on upstream Linux at version %{version} and maintains kABI
+This is the package which provides the Linux %{name} for OpenELA.
+It is based on upstream Linux at version %{version} and maintains kABI
 compatibility of a set of approved symbols, however it is heavily modified with
 backports and fixes pulled from newer upstream Linux %{name} releases. This means
 this is not a %{version} kernel anymore: it includes several components which come
@@ -559,7 +535,7 @@ from newer upstream linux versions, while maintaining a well tested and stable
 core. Some of the components/backports that may be pulled in are: changes like
 updates to the core kernel (eg.: scheduler, cgroups, memory management, security
 fixes and features), updates to block layer, supported filesystems, major driver
-updates for supported hardware in Red Hat Enterprise Linux, enhancements for
+updates for supported hardware in OpenELA, enhancements for
 enterprise customers, etc.
 
 #
@@ -807,14 +783,14 @@ kernel-gcov includes the gcov graph and source files for gcov coverage collectio
 %endif
 
 %package -n %{name}-abi-stablelists
-Summary: The Red Hat Enterprise Linux kernel ABI symbol stablelists
+Summary: The OpenELA kernel ABI symbol stablelists
 Group: System Environment/Kernel
 AutoReqProv: no
 Obsoletes: %{name}-abi-whitelists < %{specversion}-%{pkg_release}
 Provides: %{name}-abi-whitelists
 %description -n %{name}-abi-stablelists
-The kABI package contains information pertaining to the Red Hat Enterprise
-Linux kernel ABI, including lists of kernel symbols that are needed by
+The kABI package contains information pertaining to the OpenELA
+kernel ABI, including lists of kernel symbols that are needed by
 external Linux kernel modules, and a yum plugin to aid enforcement.
 
 %if %{with_kabidw_base}
@@ -823,8 +799,8 @@ Summary: The baseline dataset for kABI verification using DWARF data
 Group: System Environment/Kernel
 AutoReqProv: no
 %description kernel-kabidw-base-internal
-The package contains data describing the current ABI of the Red Hat Enterprise
-Linux kernel, suitable for the kabi-dw tool.
+The package contains data describing the current ABI of the OpenELA
+kernel, suitable for the kabi-dw tool.
 %endif
 
 #
@@ -898,7 +874,7 @@ Requires: %{name}%{?1:-%{1}}-modules-uname-r = %{KVERREL}%{?variant}%{?1:+%{1}}\
 AutoReq: no\
 AutoProv: yes\
 %description %{?1:%{1}-}modules-internal\
-This package provides kernel modules for the %{?2:%{2} }kernel package for Red Hat internal usage.\
+This package provides kernel modules for the %{?2:%{2} }kernel package for OpenELA internal usage.\
 %{nil}
 
 #
@@ -1101,6 +1077,7 @@ mv linux-%{specversion}-%{pkgrelease} linux-%{KVERREL}
 cd linux-%{KVERREL}
 
 ApplyOptionalPatch linux-kernel-test.patch
+ApplyOptionalPatch 1000-Debrand-specific-Red-Hat-messages.patch
 
 # END OF PATCH APPLICATIONS
 
@@ -1750,7 +1727,7 @@ BuildKernel() {
     # build a BLS config for this kernel
     %{SOURCE43} "$KernelVer" "$RPM_BUILD_ROOT" "%{?variant}"
 
-    # Red Hat UEFI Secure Boot CA cert, which can be used to authenticate the kernel
+    # OpenELA UEFI Secure Boot CA cert, which can be used to authenticate the kernel
     mkdir -p $RPM_BUILD_ROOT%{_datadir}/doc/kernel-keys/$KernelVer
     install -m 0644 %{secureboot_ca_0} $RPM_BUILD_ROOT%{_datadir}/doc/kernel-keys/$KernelVer/kernel-signing-ca.cer
     %ifarch s390x ppc64le
-- 
2.39.3

